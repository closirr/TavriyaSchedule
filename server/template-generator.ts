import * as XLSX from 'xlsx';
import { join } from 'path';

export interface TemplateVariant {
  name: string;
  filename: string;
  description: string;
  data: any[][];
}

// Вариант 1: Формат как в текущем расписании (точная копия)
export function createWeeklyTemplate(): TemplateVariant {
  const data = [
    ['РАСПИСАНИЕ ЗАНЯТИЙ ТАВРИЧЕСКОГО КОЛЛЕДЖА', '', '', '', '', ''],
    ['', '', '', '', '', ''],
    ['Дні', '№', 'Час', 'МЕТ-11', 'МТ-11', 'ЕкДп-11', 'А-11'],
    ['ПОНЕДІЛОК', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['ВІВТОРОК', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['', '5', '15.10-16.30', '', '', '', ''],
    ['СЕРЕДА', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['ЧЕТВЕР', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['П\'ЯТНИЦЯ', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['ІНСТРУКЦІЯ ПО ЗАПОВНЕННЮ:'],
    ['1. У кожну клітинку групи вписуйте:'],
    ['   Назва предмету'],
    ['   Прізвище викладача'],
    ['   Аудиторія'],
    [''],
    ['ПРИКЛАД:'],
    ['   Математика'],
    ['   Іванов О.І.'],
    ['   каб. 101'],
    [''],
    ['2. Якщо заняття немає - залиште клітинку пустою'],
    ['3. Групи можна змінювати у заголовку стовпців']
  ];

  return {
    name: 'Як зараз (Український формат)',
    filename: 'template_current_format.xlsx',
    description: 'Точна копія вашого поточного формату розкладу. Найзвичніший для заповнення.',
    data
  };
}

// Вариант 2: Русский формат (аналогичный украинскому)
export function createSimpleListTemplate(): TemplateVariant {
  const data = [
    ['РАСПИСАНИЕ ЗАНЯТИЙ ТАВРИЧЕСКОГО КОЛЛЕДЖА', '', '', '', '', ''],
    ['', '', '', '', '', ''],
    ['Дни', '№', 'Время', 'ИТ-21', 'ИТ-22', 'ЭК-21', 'А-21'],
    ['ПОНЕДЕЛЬНИК', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['ВТОРНИК', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['', '5', '15.10-16.30', '', '', '', ''],
    ['СРЕДА', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['ЧЕТВЕРГ', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['ПЯТНИЦА', '1', '9.00-10.20', '', '', '', ''],
    ['', '2', '10.30-11.50', '', '', '', ''],
    ['', '3', '12.10-13.30', '', '', '', ''],
    ['', '4', '13.40-15.00', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['ИНСТРУКЦИЯ ПО ЗАПОЛНЕНИЮ:'],
    ['1. В каждую ячейку группы вписывайте:'],
    ['   Название предмета'],
    ['   Фамилия преподавателя'],
    ['   Аудитория'],
    [''],
    ['ПРИМЕР:'],
    ['   Математика'],
    ['   Иванов А.И.'],
    ['   каб. 101'],
    [''],
    ['2. Если занятия нет - оставьте ячейку пустой'],
    ['3. Группы можно изменять в заголовке столбцов']
  ];

  return {
    name: 'Русский формат',
    filename: 'template_russian_format.xlsx', 
    description: 'Формат на русском языке, аналогичный текущему украинскому.',
    data
  };
}

// Вариант 3: Простая таблица (каждое занятие отдельно)
export function createGroupBasedTemplate(): TemplateVariant {
  const data = [
    ['РАСПИСАНИЕ ЗАНЯТИЙ - ПРОСТАЯ ТАБЛИЦА'],
    [''],
    ['День недели', 'Время начала', 'Время окончания', 'Предмет', 'Преподаватель', 'Группа', 'Аудитория'],
    ['Понедельник', '9:00', '10:20', 'Математика', 'Иванов И.И.', 'ИТ-21', '101'],
    ['Понедельник', '10:30', '11:50', 'Программирование', 'Петров П.П.', 'ИТ-21', 'Лаб-1'],
    ['Понедельник', '9:00', '10:20', 'Базы данных', 'Сидоров С.С.', 'ИТ-22', '102'],
    ['Вторник', '9:00', '10:20', 'Английский язык', 'Смирнова А.А.', 'ЭК-21', '201'],
    [''],
    ['ИНСТРУКЦИЯ ПО ЗАПОЛНЕНИЮ:'],
    ['1. Каждое занятие - отдельная строка'],
    ['2. День недели: Понедельник, Вторник, Среда, Четверг, Пятница, Суббота'],
    ['3. Время в формате Ч:ММ (например: 9:00)'],
    ['4. Заполняйте все поля для каждого занятия'],
    [''],
    ['ПУСТЫЕ СТРОКИ ДЛЯ ЗАПОЛНЕНИЯ:'],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['', '', '', '', '', '', '']
  ];

  return {
    name: 'Простая таблица',
    filename: 'template_simple_table.xlsx',
    description: 'Каждое занятие в отдельной строке. Легко заполнять построчно.',
    data
  };
}

// Вариант 4: Компактный формат (группы в столбцах)
export function createTeacherTimeMatrix(): TemplateVariant {
  const data = [
    ['РАСПИСАНИЕ ЗАНЯТИЙ - КОМПАКТНЫЙ ФОРМАТ', '', '', '', ''],
    [''],
    ['Время', 'ИТ-21', 'ИТ-22', 'ЭК-21', 'А-21'],
    ['ПОНЕДЕЛЬНИК'],
    ['9:00-10:20', 'Предмет | Преподаватель | Аудитория', 'Предмет | Преподаватель | Аудитория', 'Предмет | Преподаватель | Аудитория', 'Предмет | Преподаватель | Аудитория'],
    ['10:30-11:50', '', '', '', ''],
    ['12:10-13:30', '', '', '', ''],
    ['13:40-15:00', '', '', '', ''],
    ['ВТОРНИК'],
    ['9:00-10:20', '', '', '', ''],
    ['10:30-11:50', '', '', '', ''],
    ['12:10-13:30', '', '', '', ''],
    ['13:40-15:00', '', '', '', ''],
    ['15:10-16:30', '', '', '', ''],
    ['СРЕДА'],
    ['9:00-10:20', '', '', '', ''],
    ['10:30-11:50', '', '', '', ''],
    ['12:10-13:30', '', '', '', ''],
    ['13:40-15:00', '', '', '', ''],
    ['ЧЕТВЕРГ'],
    ['9:00-10:20', '', '', '', ''],
    ['10:30-11:50', '', '', '', ''],
    ['12:10-13:30', '', '', '', ''],
    ['13:40-15:00', '', '', '', ''],
    ['ПЯТНИЦА'],
    ['9:00-10:20', '', '', '', ''],
    ['10:30-11:50', '', '', '', ''],
    ['12:10-13:30', '', '', '', ''],
    ['13:40-15:00', '', '', '', ''],
    [''],
    ['ИНСТРУКЦИЯ:'],
    ['Разделяйте данные знаком |'],
    ['Пример: Математика | Иванов И.И. | каб.101'],
    ['Если занятия нет - оставьте пустым']
  ];

  return {
    name: 'Компактный формат',
    filename: 'template_compact.xlsx',
    description: 'Компактная версия с разделением данных символом |. Быстро заполнять.',
    data
  };
}

export function generateAllTemplates(): TemplateVariant[] {
  return [
    createWeeklyTemplate(),
    createSimpleListTemplate(),
    createGroupBasedTemplate(),
    createTeacherTimeMatrix()
  ];
}

export function saveTemplateToFile(template: TemplateVariant, outputDir: string = './templates'): string {
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(template.data);

  // Стилизация
  ws['!cols'] = [
    { width: 15 }, { width: 25 }, { width: 25 }, { width: 25 },
    { width: 25 }, { width: 15 }, { width: 15 }, { width: 15 }
  ];

  XLSX.utils.book_append_sheet(wb, ws, 'Расписание');

  const filePath = join(outputDir, template.filename);
  XLSX.writeFile(wb, filePath);
  
  return filePath;
}