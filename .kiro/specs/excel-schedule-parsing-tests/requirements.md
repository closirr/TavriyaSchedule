# Requirements Document

## Introduction

Ця специфікація описує вимоги до тестування логіки витягування та конвертування розкладу з Excel/CSV файлів. Система парсить дані з Google Sheets у вертикальному форматі, де групи розташовані в колонках, а дні тижня є роздільниками рядків.

## Glossary

- **CSV_Parser**: Модуль, що відповідає за парсинг CSV даних з Google Sheets у об'єкти Lesson
- **Lesson**: Об'єкт, що представляє один урок з полями: день, час, предмет, викладач, група, аудиторія
- **Vertical_Format**: Формат даних, де групи розташовані в колонках, а часові слоти - в рядках
- **Time_Slot**: Часовий проміжок уроку у форматі "HH:MM-HH:MM"
- **Day_Of_Week**: День тижня українською (Понеділок, Вівторок, Середа, Четвер, П'ятниця, Субота)
- **Schedule_Metadata**: Метадані розкладу (номер тижня, семестр, формат занять)
- **Group_Column**: Структура, що зберігає інформацію про колонку групи (назва, індекси колонок предмету/викладача/аудиторії)

## Requirements

### Requirement 1: Парсинг CSV рядків

**User Story:** Як розробник, я хочу коректно парсити CSV рядки з урахуванням лапок та спеціальних символів, щоб дані не втрачались при обробці.

#### Acceptance Criteria

1. WHEN CSV рядок містить поля в лапках з комами всередині, THE CSV_Parser SHALL коректно розділити поля, зберігаючи коми всередині лапок
2. WHEN CSV рядок містить подвійні лапки ("") всередині поля, THE CSV_Parser SHALL інтерпретувати їх як одинарну лапку
3. WHEN CSV рядок містить порожні поля, THE CSV_Parser SHALL повернути порожні рядки для цих полів
4. WHEN CSV рядок містить пробіли навколо полів, THE CSV_Parser SHALL обрізати пробіли з кожного поля

### Requirement 2: Визначення дня тижня

**User Story:** Як розробник, я хочу коректно визначати день тижня з тексту комірки, щоб уроки правильно групувались по днях.

#### Acceptance Criteria

1. WHEN комірка містить назву дня тижня великими літерами (ПОНЕДІЛОК), THE CSV_Parser SHALL повернути відповідний день тижня
2. WHEN комірка містить "ПЯТНИЦЯ" або "П'ЯТНИЦЯ", THE CSV_Parser SHALL повернути "П'ятниця"
3. WHEN комірка містить текст, що не є днем тижня, THE CSV_Parser SHALL повернути null
4. WHEN комірка містить день тижня з додатковими пробілами, THE CSV_Parser SHALL коректно визначити день

### Requirement 3: Парсинг часового діапазону

**User Story:** Як розробник, я хочу коректно парсити часові діапазони з різними форматами, щоб час уроків був точним.

#### Acceptance Criteria

1. WHEN часовий рядок має формат "HH:MM-HH:MM", THE CSV_Parser SHALL повернути об'єкт з startTime та endTime
2. WHEN часовий рядок має формат "H:MM-HH:MM" (одна цифра години), THE CSV_Parser SHALL нормалізувати час до формату "0H:MM"
3. WHEN часовий рядок має формат з тире "–" (довге тире), THE CSV_Parser SHALL коректно розпізнати діапазон
4. WHEN часовий рядок не відповідає формату часу, THE CSV_Parser SHALL повернути null

### Requirement 4: Витягування метаданих

**User Story:** Як розробник, я хочу витягувати метадані розкладу з заголовкових рядків, щоб мати інформацію про тиждень та семестр.

#### Acceptance Criteria

1. WHEN заголовок містить "1 тиждень" або "I тиждень", THE CSV_Parser SHALL встановити currentWeek = 1
2. WHEN заголовок містить "2 тиждень" або "II тиждень", THE CSV_Parser SHALL встановити currentWeek = 2
3. WHEN заголовок містить "онлайн" або "дистанц", THE CSV_Parser SHALL встановити defaultFormat = "онлайн"
4. WHEN заголовок містить "офлайн" або "очн", THE CSV_Parser SHALL встановити defaultFormat = "офлайн"
5. WHEN заголовок містить інформацію про семестр, THE CSV_Parser SHALL витягнути її в поле semester

### Requirement 5: Парсинг заголовків груп

**User Story:** Як розробник, я хочу коректно визначати колонки груп з заголовкового рядка, щоб дані кожної групи парсились правильно.

#### Acceptance Criteria

1. WHEN рядок заголовка містить "час" в першій колонці, THE CSV_Parser SHALL визначити його як рядок заголовка
2. WHEN рядок заголовка містить назви груп, THE CSV_Parser SHALL створити GroupColumn для кожної групи
3. WHEN рядок заголовка містить службові слова (предмет, викладач, аудиторія), THE CSV_Parser SHALL пропустити їх при визначенні груп
4. THE CSV_Parser SHALL встановити правильні індекси колонок для предмету, викладача та аудиторії кожної групи

### Requirement 6: Парсинг вертикального формату

**User Story:** Як розробник, я хочу парсити CSV у вертикальному форматі Google Sheets, щоб отримати масив уроків.

#### Acceptance Criteria

1. WHEN CSV містить валідні дані розкладу, THE CSV_Parser SHALL повернути масив Lesson об'єктів
2. WHEN рядок містить часовий слот та дані уроку, THE CSV_Parser SHALL створити Lesson для кожної групи з даними
3. WHEN рядок не містить часу, але є дані уроку, THE CSV_Parser SHALL використати часовий слот з понеділка за індексом
4. WHEN комірка містить #ERROR або #REF, THE CSV_Parser SHALL пропустити цей урок
5. WHEN предмет та викладач порожні, THE CSV_Parser SHALL пропустити цей урок

### Requirement 7: Серіалізація уроків у CSV

**User Story:** Як розробник, я хочу серіалізувати масив уроків назад у CSV формат, щоб мати можливість експортувати дані.

#### Acceptance Criteria

1. WHEN масив уроків серіалізується з заголовком, THE CSV_Parser SHALL додати рядок заголовка першим
2. WHEN поле містить коми або лапки, THE CSV_Parser SHALL екранувати його в лапки
3. FOR ALL валідних масивів уроків, серіалізація та парсинг SHALL повернути еквівалентні дані (round-trip)

### Requirement 8: Обробка помилок

**User Story:** Як розробник, я хочу отримувати інформативні помилки при парсингу некоректних даних, щоб легко діагностувати проблеми.

#### Acceptance Criteria

1. WHEN вхідні дані є null або undefined, THE CSV_Parser SHALL повернути порожній масив уроків та помилку
2. WHEN CSV містить менше 3 рядків, THE CSV_Parser SHALL повернути помилку "Not enough data rows"
3. THE CSV_Parser SHALL повертати ParseResult з масивом errors для кожного проблемного рядка
